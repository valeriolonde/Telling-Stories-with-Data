---
title: "Distritos eleitorais vencidos por cada partido nas eleições federais do Canadá em 2019"
format: html
css: custom_style.css
---
## Preâmbulo
Purpose: Ler dados e fazer gráficos da eleição do Canadá em 2019  
Author: Valério londe  
Email: valerio.londe@gmail.com   
Date: 14 August 2023  
Prerequisites: Sabe como baixar os dados da eleição do Canadá em 2019

## Simulando dados

Em primeiro lugar, vamos simular alguns dados de distritos eleitorais vencidos por cada partido nas eleições federais do Canadá.
Para simular nossos dados, precisamos criar um conjunto de dados com duas variáveis: “Liberal”, “Conservative”, "Bloc Québécois" ou Party", e alguns valores para cada uma. No caso de “Divisão”, os valores razoáveis seriam o nome de uma das 338 cadeiras canadenses. No caso de “Partido”, os valores razoáveis seriam um dos quatro seguintes: “Liberal”, “Conservative”, “Bloc Québécois” ou “Outro”. 

```{r, message=FALSE, warning=FALSE}
setwd("C:/Users/Cliente/Desktop/R Projects/Exploring canada elections")


library(tidyverse)
library(janitor)
library(data.table)
```

```{r, message=FALSE, warning=FALSE}
# Definindo a quantidade total de assentos e os partidos
total_seats <- 338
parties <- c("Liberal", "Conservative", "New Democratic Party", "Bloc Québécois", "Green")

set.seed(42) # Para resultados reprodutíveis

# Gere uma sequência aleatória de partidos totalizando 338 entradas
random_party_sequence <- sample(parties, total_seats, replace = TRUE)

# Conta quantas vezes cada partido aparece na sequência
seats_won <- table(random_party_sequence)

# Criando um dataframe para plotagem
election_data <- as.data.frame(seats_won)
colnames(election_data) <- c("Party", "Seats")

# Plotando o gráfico
ggplot(election_data, aes(x = reorder(Party, -Seats), y = Seats, fill = Party)) +
  geom_bar(stat = "identity",show.legend = FALSE) +  # Desativa a legenda para este layer) +
  labs(title = "Seats Won in the 2021 Canadian Federal Election (Simulated)",
       x = "Party",
       y = "Number of Seats") +
  theme_minimal()
```


## Adquirindo dados verdadeiros 

Agora vamos atrás dos dados verdadeiros da eleição de 2019 no Canadá e fazer uma análise simples de quais partidos ganharam mais assentos na eleição.Vamos, primeiramente, importar os dados e fazer uma limpeza.

```{r, message=FALSE, warning=FALSE}
#| echo: true
# Importando base de dados usando data.table
df <- fread("table_tableau11.csv", header = TRUE)

# Limpando os nomes e selecionando a coluna de candidatos selecionados
df <- df %>% 
  clean_names()

# Selecionando colunas de interesse
selected_df <- df[, .(electoral_district_name_nom_de_circonscription, elected_candidate_candidat_elu)]
```

Estaremos pegando apenas o nome do partido e vendo quantas cadeiras cada partido ganhou.

```{r, message=FALSE, warning=FALSE}
# Aplicando ifelse() diretamente no data.table
selected_df[, party := 
            ifelse(grepl("Green Party", elected_candidate_candidat_elu), "Green Party",
            ifelse(grepl("NDP-New Democratic Party", elected_candidate_candidat_elu), "NDP-New Democratic Party",
            ifelse(grepl("Liberal", elected_candidate_candidat_elu), "Liberal",
            ifelse(grepl("Conservative", elected_candidate_candidat_elu), "Conservative",
            ifelse(grepl("Québécois", elected_candidate_candidat_elu), "Québécois",
            "Unknown Party")))))]

```

```{r, message=FALSE, warning=FALSE}
# Agregando dados
party_counts <- selected_df[, .(count = .N), by = party] 

party_counts
```

Criando o gráfico para vizualisar cada partido. 

```{r, message=FALSE, warning=FALSE}
# Criando o gráfico
ggplot(party_counts, aes(x = reorder(party, count), y = count, fill = party)) +
  geom_bar(stat = "identity", color = "black") +  # Adiciona borda preta ao redor das barras
  geom_text(aes(label = count), position = position_dodge(width = 0.2), hjust = -0.1) +  # Adiciona o número exato nas barras
  coord_flip() +
  scale_fill_brewer(palette = "Set3") +  # Usa uma paleta de cores do RColorBrewer
  labs(title = "Distritos Eleitorais Vencidos por Cada Partido nas \n Eleições Federais Canadenses de 2019",
       x = "Partido",
       y = "Número de Distritos Eleitorais") +
  theme_minimal() +
  theme(legend.position = "none")  # Remove a legenda

```
## Conclusão

O Canadá é uma democracia parlamentar com 338 assentos na câmara dos representantes. Existem dois partidos principais -- "Liberal" e "Conservador" --, além de partidos menores -- "New Democratic Party" e "Bloc Québécois" e "Green Party". A eleição federal canadense de  20 de setembro de 2021, para eleger os membros da Câmara dos Comuns do Parlamento. (formalmente a 43ª eleição geral canadense) foi a eleição para renovar a Câmara dos Comuns do Canadá. Estávamos interessados no número de assentos conquistados por cada partido.

Baixamos os resultados, por assento específico, no site https://tellingstorieswithdata.com/02-drinking_from_a_fire_hose.html. Limpamos e organizamos o conjunto de dados usando a linguagem de programação estatística R (R Core Team 2023), incluindo o alignverse (Wickham et al. 2019),janitor (Firke 2023) e data.table (2008) . Em seguida, criamos um gráfico do número de assentos conquistados por cada partido político (Figura acima).

Descobrimos que o Partido Liberal conquistou 160 cadeiras, seguido pelo Partido Conservador com 119 cadeiras. Os partidos menores obtiveram o seguinte número de assentos: os Quebécois obtiveram 32 assentos e os new Democratic Party obtiveram 25 assentos e Green Party 2 assentos..












